<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de la Liga Profesional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .table-header-a { background-color: #05664F; color: white; }
        .table-header-b { background-color: #4C3A7A; color: white; }
        .boca-row { background-color: #fefce8 !important; font-weight: 700; }
        
        /* Clasificación a copas */
        .clasi-libertadores-directo { border-left: 4px solid #1e40af; }
        .clasi-libertadores-repechaje { border-left: 4px solid #3b82f6; }
        .clasi-sudamericana { border-left: 4px solid #ea580c; }
        .playoff-spot { border-left: 4px solid #16a34a; }
        
        .input-score {
            width: 45px; text-align: center; border: 1px solid #cbd5e1;
            border-radius: 0.375rem; padding: 2px 4px; font-weight: 500;
        }
        .input-score:focus {
            outline: none; border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        .team-logo { width: 24px; height: 24px; object-fit: contain; }
        
        /* Estilo para equipos eliminados */
        .eliminated-row {
            background-color: #e5e7eb !important;
            color: #9ca3af;
        }
        .eliminated-row .team-logo {
             filter: grayscale(100%);
        }

        /* Toggle Switch */
        .toggle-label { position: relative; display: inline-block; width: 44px; height: 24px; }
        .toggle-label input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2563eb; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Estilos del Bracket de Playoffs */
        .playoff-wrapper {
          width: 100%;
          overflow-x: auto;
        }
        .bracket {
            display: flex;
            overflow-x: visible; 
            padding: 20px;
            background-color: #e2e8f0; /* Fondo gris claro para el bracket */
            border-radius: 0.5rem;
            direction: ltr;          /* asegura orden izq→der */
        }
        .playoff-bracket {
          min-width: 700px;
        }

        @media (max-width: 768px) {
          .playoff-bracket {
            font-size: 12px;
          }
        }
        .round {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            flex-basis: 200px;
            flex-shrink: 0;
        }
        .round-title {
            text-align: center;
            font-weight: 600;
            color: #475569;
            margin-bottom: 20px;
        }
        .matchup {
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex-grow: 1;
        }
        .match-item {
            background-color: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            padding: 8px;
            margin: 5px 0;
        }
        .team {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
        }
        .team img {
            margin-right: 8px;
        }
        .team-pos {
             margin-left: auto;
             font-size: 0.7rem;
             color: #64748b;
             font-weight: 600;
        }
        .placeholder-match {
            background-color: #f1f5f9;
            border: 1px dashed #94a3b8;
            border-radius: 0.375rem;
            padding: 8px;
            margin: 5px 0;
            height: 62px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #64748b;
        }
        .connector {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 30px;
        }
        .connector-line {
            position: relative;
            flex-grow: 1;
        }
        .connector-line::before {
            content: '';
            position: absolute;
            width: 50%;
            height: 2px;
            background: #94a3b8;
            top: 50%;
            transform: translateY(-50%);
        }
        .connector-line::after {
            content: '';
            position: absolute;
            width: 2px;
            background: #94a3b8;
        }

        /* Conectores que van de 2 a 1 */
        .connector-2-to-1::after {
            height: 50%;
            top: 25%;
        }
        .left .connector-2-to-1::before { left: 0; }
        .left .connector-2-to-1::after { right: 0; }
        .right .connector-2-to-1::before { right: 0; }
        .right .connector-2-to-1::after { left: 0; }

        /* Conectores que van de 1 a 1 */
        .connector-1-to-1::before {
             width: 100%;
        }

        /* --- INICIO: ESTILOS VERSIÓN MÓVIL --- */
        /* Fuerza una sola columna en el layout principal */
        body.mobile-version .xl\:grid-cols-3 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        /* Fuerza una sola columna en las tablas de zona */
        body.mobile-version .lg\:grid-cols-2 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        /* Desactiva el "sticky" del fixture */
        body.mobile-version .xl\:sticky {
            position: static;
        }
        /* Ajusta paddings generales */
        body.mobile-version .p-8 { padding: 1rem; }
        body.mobile-version .p-6 { padding: 1rem; }
        body.mobile-version .p-4 { padding: 0.75rem; }
        body.mobile-version .p-3 { padding: 0.5rem; }
        body.mobile-version .p-2 { padding: 0.5rem; }
        
        /* Ajusta gaps y márgenes */
        body.mobile-version .gap-6 { gap: 1rem; }
        body.mobile-version .gap-8 { gap: 1rem; }
        body.mobile-version .mb-8 { margin-bottom: 1.5rem; }
        body.mobile-version .mb-6 { margin-bottom: 1.5rem; }
        
        /* Ajusta tamaños de fuente */
        body.mobile-version .text-4xl { font-size: 1.875rem; }
        body.mobile-version .text-3xl { font-size: 1.5rem; }
        body.mobile-version .text-2xl { font-size: 1.25rem; }
        body.mobile-version .text-xl { font-size: 1.125rem; }
        body.mobile-version .text-lg { font-size: 1rem; }
        
        /* Fuerza los controles a apilarse verticalmente */
        body.mobile-version .sm\:flex-row { 
            flex-direction: column; 
        }
        /* --- FIN: ESTILOS VERSIÓN MÓVIL --- */

    </style>
</head>
<body class="p-2 sm:p-4 md:p-6">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-6 md:mb-8">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-slate-800">Simulador de Playoffs - Liga Profesional</h1>
            <p class="text-sm sm:text-base text-slate-600 mt-2">Ingresa los resultados y mira cómo se actualizan las tablas y cruces.</p>
            <!-- BOTÓN PARA VERSIÓN MÓVIL AÑADIDO -->
            <button id="mobile-toggle-btn" onclick="toggleMobileView()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">
                Versión móvil
            </button>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 md:gap-8">
            <!-- Columna de Fixture -->
            <div class="xl:col-span-1">
                <div id="fixture-container" class="bg-white p-3 sm:p-4 rounded-lg shadow-md xl:sticky top-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg sm:text-xl font-bold text-slate-700">Fixture Restante</h2>
                        <button onclick="resetResults()" class="flex items-center gap-2 bg-rose-600 hover:bg-rose-700 text-white text-xs font-bold py-2 px-3 rounded-lg shadow-md transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.898 2.566 1 1 0 01-1.898.634A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm12 16a1 1 0 01-1-1v-2.101a7.002 7.002 0 01-11.898-2.566 1 1 0 011.898-.634A5.002 5.002 0 0014.001 13H11a1 1 0 010-2h5a1 1 0 011 1v5a1 1 0 01-1 1z" clip-rule="evenodd" />
                            </svg>
                            <span>Reiniciar</span>
                        </button>
                    </div>
                    <div id="matches-container">
                        <!-- El contenido se generará con JS -->
                    </div>
                </div>
            </div>

            <!-- Columna de Tablas y Playoffs -->
            <div class="xl:col-span-2 space-y-6 md:space-y-8">
                
                <!-- Controles -->
                <div class="bg-white p-4 rounded-lg shadow-md flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8">
                    <div class="flex items-center space-x-3">
                        <span class="text-sm font-medium text-slate-700 text-center">Mostrar solo equipos con chances</span>
                        <label class="toggle-label">
                            <input type="checkbox" id="toggle-chances" onchange="renderTables()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="text-sm font-medium text-slate-700">Mostrar Tabla Anual</span>
                        <label class="toggle-label">
                            <input type="checkbox" id="toggle-anual" onchange="toggleAnualTable()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Zonas -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-3 sm:p-4 rounded-lg shadow-md">
                        <h3 class="text-base sm:text-lg font-bold text-center mb-3 text-white bg-[#05664F] py-2 rounded-t-md">Clausura - Zona A</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="table-header-a">
                                    <tr>
                                        <th class="p-2">#</th><th class="p-2">Equipo</th><th class="p-2">Pts</th><th class="p-2">PJ</th><th class="p-2">+/-</th><th class="p-2">Máx</th>
                                    </tr>
                                </thead>
                                <tbody id="table-clausura-a"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white p-3 sm:p-4 rounded-lg shadow-md">
                        <h3 class="text-base sm:text-lg font-bold text-center mb-3 text-white bg-[#4C3A7A] py-2 rounded-t-md">Clausura - Zona B</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="table-header-b">
                                     <tr>
                                        <th class="p-2">#</th><th class="p-2">Equipo</th><th class="p-2">Pts</th><th class="p-2">PJ</th><th class="p-2">+/-</th><th class="p-2">Máx</th>
                                    </tr>
                                </thead>
                                <tbody id="table-clausura-b"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Cruces de Playoffs -->
                <div class="bg-white p-3 sm:p-4 rounded-lg shadow-md">
                    <h3 class="text-base sm:text-lg font-bold text-slate-700 mb-4 text-center">Cuadro de Playoffs</h3>
                    <div id="playoffs-container">
                        <!-- Generado por JS -->
                    </div>
                </div>

                <!-- Tabla Anual (Oculta por defecto) -->
                <div id="anual-container" class="bg-white p-3 sm:p-4 rounded-lg shadow-md hidden">
                    <h3 class="text-base sm:text-lg font-bold text-slate-700 mb-3 text-center">Tabla Anual</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-slate-700 text-white">
                                <tr>
                                    <th class="p-2">#</th><th class="p-2">Equipo</th><th class="p-2">Pts</th><th class="p-2">PJ</th><th class="p-2">+/-</th>
                                </tr>
                            </thead>
                            <tbody id="table-anual"></tbody>
                        </table>
                    </div>
                     <div class="mt-4 text-xs text-slate-500 space-y-1">
                        <p><span class="inline-block w-3 h-3 rounded-full bg-[#1e40af] mr-2"></span>Libertadores (Fase de Grupos)</p>
                        <p><span class="inline-block w-3 h-3 rounded-full bg-[#3b82f6] mr-2"></span>Libertadores (Repechaje)</p>
                        <p><span class="inline-block w-3 h-3 rounded-full bg-[#ea580c] mr-2"></span>Sudamericana</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// DATOS INICIALES BASADOS EN LAS CAPTURAS (ACTUALIZADOS POST FECHA 15)
let initialTeamsData = {
    // Zona A
    'Boca Juniors': { group: 'A', clausura: { pts: 26, j: 15, gf: 26, gc: 12 }, anual: { pts: 59, j: 31, gf: 50, gc: 23 } },
    'Unión': { group: 'A', clausura: { pts: 24, j: 15, gf: 20, gc: 13 }, anual: { pts: 38, j: 31, gf: 31, gc: 30 } }, // Anual 38 (31+7) -> 38
    'Central Córdoba (SdE)': { group: 'A', clausura: { pts: 23, j: 15, gf: 16, gc: 10 }, anual: { pts: 41, j: 31, gf: 37, gc: 32 } }, // Anual 41 (36+5) -> 41
    'Tigre': { group: 'A', clausura: { pts: 22, j: 15, gf: 14, gc: 11 }, anual: { pts: 49, j: 31, gf: 32, gc: 23 } },
    'Barracas Central': { group: 'A', clausura: { pts: 22, j: 15, gf: 18, gc: 16 }, anual: { pts: 48, j: 31, gf: 38, gc: 34 } },
    'Racing Club': { group: 'A', clausura: { pts: 22, j: 15, gf: 15, gc: 13 }, anual: { pts: 50, j: 31, gf: 41, gc: 29 } }, // Anual 50 (43+7) -> 50
    'Argentinos Juniors': { group: 'A', clausura: { pts: 21, j: 15, gf: 16, gc: 12 }, anual: { pts: 54, j: 31, gf: 40, gc: 21 } }, // Anual 54 (48+6) -> 54
    'Estudiantes (LP)': { group: 'A', clausura: { pts: 21, j: 15, gf: 16, gc: 16 }, anual: { pts: 42, j: 31, gf: 34, gc: 35 } }, // Anual 42 (39+3) -> 42
    'Banfield': { group: 'A', clausura: { pts: 20, j: 15, gf: 14, gc: 20 }, anual: { pts: 34, j: 31, gf: 28, gc: 39 } }, // Anual 34 (28+6) -> 34
    'Belgrano': { group: 'A', clausura: { pts: 19, j: 15, gf: 13, gc: 11 }, anual: { pts: 36, j: 31, gf: 26, gc: 34 } }, // Anual 36 (32+4) -> 36
    'Defensa y Justicia': { group: 'A', clausura: { pts: 19, j: 15, gf: 14, gc: 17 }, anual: { pts: 38, j: 31, gf: 32, gc: 39 } },
    'Huracán': { group: 'A', clausura: { pts: 19, j: 15, gf: 9, gc: 14 }, anual: { pts: 46, j: 31, gf: 28, gc: 26 } }, // Anual 46 (43+3) -> 46
    'Aldosivi': { group: 'A', clausura: { pts: 15, j: 15, gf: 9, gc: 16 }, anual: { pts: 30, j: 31, gf: 27, gc: 44 } }, // Anual 30 (24+6) -> 30
    'Newell\'s': { group: 'A', clausura: { pts: 14, j: 15, gf: 13, gc: 22 }, anual: { pts: 33, j: 31, gf: 25, gc: 37 } }, // Anual 33 (30+3) -> 33
    'Ind. Rivadavia': { group: 'A', clausura: { pts: 13, j: 15, gf: 12, gc: 17 }, anual: { pts: 40, j: 31, gf: 32, gc: 34 } }, // Anual 40 (39+1) -> 40

    // Zona B
    'Rosario Central': { group: 'B', clausura: { pts: 31, j: 15, gf: 18, gc: 7 }, anual: { pts: 66, j: 31, gf: 40, gc: 15 } },
    'Riestra': { group: 'B', clausura: { pts: 27, j: 15, gf: 18, gc: 11 }, anual: { pts: 51, j: 31, gf: 31, gc: 18 } }, // Anual 51 (47+4) -> 51
    'Lanús': { group: 'B', clausura: { pts: 27, j: 15, gf: 17, gc: 12 }, anual: { pts: 47, j: 31, gf: 30, gc: 23 } }, // Anual 47 (43+4) -> 47
    'Vélez Sarsfield': { group: 'B', clausura: { pts: 25, j: 15, gf: 19, gc: 12 }, anual: { pts: 39, j: 31, gf: 26, gc: 34 } }, // Anual 39 (36+3) -> 39
    'San Lorenzo': { group: 'B', clausura: { pts: 23, j: 15, gf: 12, gc: 10 }, anual: { pts: 50, j: 31, gf: 26, gc: 20 } },
    'River Plate': { group: 'B', clausura: { pts: 21, j: 15, gf: 20, gc: 15 }, anual: { pts: 52, j: 31, gf: 41, gc: 24 } },
    'Talleres (C)': { group: 'B', clausura: { pts: 20, j: 15, gf: 9, gc: 12 }, anual: { pts: 33, j: 31, gf: 20, gc: 27 } }, // Anual 33 (27+6) -> 33
    'San Martín (SJ)': { group: 'B', clausura: { pts: 19, j: 15, gf: 11, gc: 12 }, anual: { pts: 28, j: 31, gf: 16, gc: 30 } }, // Anual 28 (23+5) -> 28
    'Sarmiento (J)': { group: 'B', clausura: { pts: 19, j: 15, gf: 12, gc: 16 }, anual: { pts: 34, j: 31, gf: 23, gc: 35 } }, // Anual 34 (30+4) -> 34
    'Gimnasia (LP)': { group: 'B', clausura: { pts: 19, j: 15, gf: 11, gc: 16 }, anual: { pts: 35, j: 31, gf: 20, gc: 34 } }, // Anual 35 (29+6) -> 35
    'Atlético Tucumán': { group: 'B', clausura: { pts: 18, j: 15, gf: 16, gc: 19 }, anual: { pts: 34, j: 31, gf: 33, gc: 40 } }, // Anual 34 (30+4) -> 34
    'Independiente': { group: 'B', clausura: { pts: 15, j: 15, gf: 13, gc: 13 }, anual: { pts: 44, j: 31, gf: 36, gc: 25 } }, // Anual 44 (35+9) -> 44
    'Instituto': { group: 'B', clausura: { pts: 15, j: 15, gf: 9, gc: 17 }, anual: { pts: 33, j: 31, gf: 25, gc: 37 } },
    'Platense': { group: 'B', clausura: { pts: 12, j: 15, gf: 12, gc: 22 }, anual: { pts: 35, j: 31, gf: 25, gc: 33 } }, // Anual 35 (33+2) -> 35
    /* Error en G-E-P de Platense, Anual 33+2=35. */
    'Godoy Cruz': { group: 'B', clausura: { pts: 11, j: 15, gf: 10, gc: 18 }, anual: { pts: 28, j: 31, gf: 18, gc: 36 } }, // Anual 28 (27+1) -> 28
};

const teamLogos = { 
    'Boca Juniors': 'https://upload.wikimedia.org/wikipedia/commons/c/c9/Boca_escudo.png', 
    'River Plate': 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Logo_River_Plate.png/500px-Logo_River_Plate.png', 
    'Racing Club': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Escudo_de_Racing_Club_%282014%29.svg/247px-Escudo_de_Racing_Club_%282014%29.svg.png', 
    'Independiente': 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Escudo_del_Club_Atl%C3%A9tico_Independiente.svg/474px-Escudo_del_Club_Atl%C3%A9tico_Independiente.svg.png', 
    'San Lorenzo': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/62/Escudo_del_Club_Atl%C3%A9tico_San_Lorenzo_de_Almagro.png/960px-Escudo_del_Club_Atl%C3%A9tico_San_Lorenzo_de_Almagro.png', 
    'Vélez Sarsfield': 'https://upload.wikimedia.org/wikipedia/commons/3/36/Escudo_V%C3%A9lez_Sarsfield.png', 
    'Estudiantes (LP)': 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Escudo_de_Estudiantes_de_La_Plata.svg/350px-Escudo_de_Estudiantes_de_La_Plata.svg.png', 
    'Rosario Central': 'https://w7.pngwing.com/pngs/372/1004/png-transparent-rosario-central-superliga-argentina-de-futbol-football-logo-football-emblem-text-plate-thumbnail.png', 
    'Lanús': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Escudo_de_Lan%C3%BAs.png/960px-Escudo_de_Lan%C3%BAs.png', 
    'Huracán': 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg/500px-Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg.png', 
    'Argentinos Juniors': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Asociaci%C3%B3n_Atl%C3%A9tica_Argentinos_Juniors.svg/599px-Escudo_de_la_Asociaci%C3%B3n_Atl%C3%A9tica_Argentinos_Juniors.svg.png', 
    'Tigre': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Escudo_del_Club_Atl%C3%A9tico_Tigre.svg/500px-Escudo_del_Club_Atl%C3%A9tico_Tigre.svg.png', 
    'Platense': 'https://upload.wikimedia.org/wikipedia/commons/d/d4/Escudo_De_Platense.png', 
    'Defensa y Justicia': 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/70/Escudo_del_Club_Social_y_Deportivo_Defensa_y_Justicia.svg/250px-Escudo_del_Club_Social_y_Deportivo_Defensa_y_Justicia.svg.png', 
    'Sarmiento (J)': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg/275px-Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg.png', 
    'Unión': 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Escudo_club_Atl%C3%A9tico_Uni%C3%B3n_de_santa_fe.svg/250px-Escudo_club_Atl%C3%A9tico_Uni%C3%B3n_de_santa_fe.svg.png', 
    'Central Córdoba (SdE)': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg/582px-Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg.png', 
    'Barracas Central': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Barracas_central_logo.svg/500px-Barracas_central_logo.svg.png', 
    'Instituto': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Escudo_Instituto_Atletico_Central_Cordoba.png/960px-Escudo_Instituto_Atletico_Central_Cordoba.png', 
    'Belgrano': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png/600px-Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png', 
    'Ind. Rivadavia': 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Escudo_del_Club_Independiente_Rivadavia.svg/596px-Escudo_del_Club_Independiente_Rivadavia.svg.png', 
    'Riestra': 'https://upload.wikimedia.org/wikipedia/commons/c/c6/Escudo_de_Deportivo_Riestra.png', 
    'Talleres (C)': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Escudo_Talleres_2015.svg/595px-Escudo_Talleres_2015.svg.png', 
    'San Martín (SJ)': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Escudo_de_San_Martin_de_San_Juan.svg/577px-Escudo_de_San_Martin_de_San_Juan.svg.png', 
    'Newell\'s': 'https://upload.wikimedia.org/wikipedia/commons/b/b0/Newell%27s_Old_Boys_Escudo.png', 
    'Aldosivi': 'https://upload.wikimedia.org/wikipedia/en/thumb/2/2a/Aldosivi_logo.svg/250px-Aldosivi_logo.svg.png', 
    'Banfield': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CA_Banfield_%282014%29.svg/733px-CA_Banfield_%282014%29.svg.png', 
    'Atlético Tucumán': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/Escudo_del_Club_Atletico_Tucuman.svg/511px-Escudo_del_Club_Atletico_Tucuman.svg.png', 
    'Gimnasia (LP)': 'https://w7.pngwing.com/pngs/650/306/png-transparent-club-de-gimnasia-y-esgrima-la-plata-polideportivo-gimnasia-y-esgrima-la-plata-logo-graphic-design-design-emblem-logo-area-thumbnail.png', 
    'Godoy Cruz': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Escudo_del_Club_Deportivo_Godoy_Cruz_Antonio_Tomba.svg/600px-Escudo_del_Club_Deportivo_Godoy_Cruz_Antonio_Tomba.svg.png' 
};

// Solo queda la Fecha 16
let initialRemainingMatches = [
    { fecha: 16, local: 'Vélez Sarsfield', visitante: 'River Plate' },
    { fecha: 16, local: 'Platense', visitante: 'Gimnasia (LP)' },
    { fecha: 16, local: 'San Lorenzo', visitante: 'Sarmiento (J)' },
    { fecha: 16, local: 'Aldosivi', visitante: 'San Martín (SJ)' },
    { fecha: 16, local: 'Instituto', visitante: 'Talleres (C)' },
    { fecha: 16, local: 'Independiente', visitante: 'Rosario Central' },
    { fecha: 16, local: 'Godoy Cruz', visitante: 'Riestra' },
    { fecha: 16, local: 'Lanús', visitante: 'Atlético Tucumán' },
    { fecha: 16, local: 'Boca Juniors', visitante: 'Tigre' },
    { fecha: 16, local: 'Belgrano', visitante: 'Unión' },
    { fecha: 16, local: 'Barracas Central', visitante: 'Huracán' },
    { fecha: 16, local: 'Estudiantes (LP)', visitante: 'Argentinos Juniors' },
    { fecha: 16, local: 'Newell\'s', visitante: 'Racing Club' },
    { fecha: 16, local: 'Defensa y Justicia', visitante: 'Ind. Rivadavia' },
    { fecha: 16, local: 'Central Córdoba (SdE)', visitante: 'Banfield' },
];

let matchResults = {};

document.addEventListener('DOMContentLoaded', () => {
    // Eliminar equipos que no están en las nuevas tablas
    const equiposEnNuevasTablas = {
        ...initialTeamsData
    };
    
    // Filtrar equipos que ya no existen en los datos nuevos
    Object.keys(initialTeamsData).forEach(teamName => {
        if (!equiposEnNuevasTablas[teamName]) {
            delete initialTeamsData[teamName];
        }
    });

    // Filtrar partidos restantes si algún equipo ya no existe
    initialRemainingMatches = initialRemainingMatches.filter(match => {
        return initialTeamsData[match.local] && initialTeamsData[match.visitante];
    });


    renderMatches();
    renderTables();
    
    // Agregar el listener para reescalar en resize
    window.addEventListener('resize', fitBracket);
});

function renderTables() {
    let currentData = JSON.parse(JSON.stringify(initialTeamsData));

    for (const matchId in matchResults) {
        const match = matchResults[matchId];
        if (match.localScore === null || match.visitorScore === null) continue;

        // Asegurarse que los equipos existen antes de actualizar
        if (currentData[match.local] && currentData[match.visitante]) {
            const local = currentData[match.local];
            const visitor = currentData[match.visitante];
            local.clausura.j++; visitor.clausura.j++;
            local.anual.j++; visitor.anual.j++;
            local.clausura.gf += match.localScore; visitor.clausura.gf += match.visitorScore;
            local.clausura.gc += match.visitorScore; visitor.clausura.gc += match.localScore;
            local.anual.gf += match.localScore; visitor.anual.gf += match.visitorScore;
            local.anual.gc += match.visitorScore; visitor.anual.gc += match.localScore;
            if (match.localScore > match.visitorScore) {
                local.clausura.pts += 3; local.anual.pts += 3;
            } else if (match.visitorScore > match.localScore) {
                visitor.clausura.pts += 3; visitor.anual.pts += 3;
            } else {
                local.clausura.pts += 1; visitor.clausura.pts += 1;
                local.anual.pts += 1; visitor.anual.pts += 1;
            }
        }
    }

    const allTeamsArray = Object.entries(currentData).map(([name, data]) => ({ name, ...data }));
    let groupA = allTeamsArray.filter(t => t.group === 'A').map(t => ({name: t.name, ...t.clausura, group: t.group}));
    let groupB = allTeamsArray.filter(t => t.group === 'B').map(t => ({name: t.name, ...t.clausura, group: t.group}));
    
    const sortTable = (teams) => teams.sort((a, b) => {
        if (b.pts !== a.pts) return b.pts - a.pts;
        const diffA = a.gf - a.gc; const diffB = b.gf - b.gc;
        if (diffB !== diffA) return diffB - diffA;
        if (b.gf !== a.gf) return b.gf - a.gf;
        return a.name.localeCompare(b.name);
    });

    let sortedA = sortTable(groupA);
    let sortedB = sortTable(groupB);

    const umbralA = sortedA.length > 7 ? sortedA[7].pts : 0;
    const umbralB = sortedB.length > 7 ? sortedB[7].pts : 0;
    const showOnlyWithChances = document.getElementById('toggle-chances').checked;

    const generateRowHTML = (team, i, umbral) => {
        const partidosRestantes = 16 - team.j;
        const maxPts = team.pts + (partidosRestantes * 3);
        const hasChances = maxPts >= umbral;
        if (showOnlyWithChances && !hasChances) return '';
        return `
        <tr class="${team.name === 'Boca Juniors' ? 'boca-row' : 'odd:bg-slate-50'} ${i < 8 ? 'playoff-spot' : ''} ${!hasChances ? 'eliminated-row' : ''}">
            <td class="p-2 font-medium">${i + 1}</td>
            <td class="p-2 flex items-center gap-2"><img src="${teamLogos[team.name] || ''}" class="team-logo" alt="logo">${team.name}</td>
            <td class="p-2 font-semibold">${team.pts}</td><td class="p-2">${team.j}</td><td class="p-2">${team.gf - team.gc}</td>
            <td class="p-2 ${hasChances ? 'text-green-600' : 'text-red-600'} font-medium">${maxPts}</td>
        </tr>`;
    };

    document.getElementById('table-clausura-a').innerHTML = sortedA.map((t, i) => generateRowHTML(t, i, umbralA)).join('');
    document.getElementById('table-clausura-b').innerHTML = sortedB.map((t, i) => generateRowHTML(t, i, umbralB)).join('');
    
    const anualTableData = allTeamsArray.map(t => ({name: t.name, ...t.anual}));
    const sortedAnual = sortTable(anualTableData);
    document.getElementById('table-anual').innerHTML = sortedAnual.map((t, i) => `
        <tr class="${t.name === 'Boca Juniors' ? 'boca-row' : 'odd:bg-slate-50'} ${i < 2 ? 'clasi-libertadores-directo' : ''} ${i === 2 ? 'clasi-libertadores-repechaje' : ''} ${i >= 3 && i < 9 ? 'clasi-sudamericana' : ''}">
            <td class="p-2 font-medium">${i + 1}</td>
            <td class="p-2 flex items-center gap-2"><img src="${teamLogos[t.name] || ''}" class="team-logo" alt="logo">${t.name}</td>
            <td class="p-2 font-semibold">${t.pts}</td><td class="p-2">${t.j}</td><td class="p-2">${t.gf - t.gc}</td>
        </tr>`).join('');

    renderPlayoffs(sortedA, sortedB);
    // Añadimos el event listener después de renderizar el bracket
    addBracketListeners();
    // Llamar a fitBracket después de que todo se haya renderizado
    fitBracket();
}

function renderPlayoffs(sortedA, sortedB) {
    const playoffsContainer = document.getElementById('playoffs-container');
    const bracketHTML = `
        <div class="playoff-wrapper"> 
            <div class="bracket playoff-bracket">
                <!-- OCTAVOS -->
                <div class="round">
                    <div class="round-title">8vos de Final</div>
                    ${generateMatchupHTML(sortedA[0], sortedB[7], '1°A', '8°B', 'r16-1')}
                    ${generateMatchupHTML(sortedA[3], sortedB[4], '4°A', '5°B', 'r16-2')}
                    ${generateMatchupHTML(sortedA[1], sortedB[6], '2°A', '7°B', 'r16-3')}
                    ${generateMatchupHTML(sortedA[2], sortedB[5], '3°A', '6°B', 'r16-4')}
                </div>
                <!-- CONECTORES Y CUARTOS -->
                <div class="connector left">
                    <div class="connector-line connector-2-to-1"></div>
                    <div class="connector-line connector-2-to-1"></div>
                </div>
                <div class="round">
                    <div class="round-title">4tos de Final</div>
                    ${generateMatchupHTML(null, null, null, null, 'r8-1')}
                    ${generateMatchupHTML(null, null, null, null, 'r8-2')}
                </div>
                <!-- CONECTORES Y SEMIS -->
                <div class="connector left">
                    <div class="connector-line connector-2-to-1"></div>
                </div>
                <div class="round">
                    <div class="round-title">Semifinales</div>
                    ${generateMatchupHTML(null, null, null, null, 'r4-1')}
                </div>
                <!-- FINAL -->
                <div class="connector">
                    <div class="connector-line connector-1-to-1"></div>
                </div>
                <div class="round">
                     <div class="round-title">Final</div>
                    ${generateMatchupHTML(null, null, null, null, 'r2-1')}
                </div>
                <div class="connector">
                    <div class="connector-line connector-1-to-1"></div>
                </div>
                <!-- CONECTORES Y SEMIS -->
                 <div class="round">
                    <div class="round-title">Semifinales</div>
                    ${generateMatchupHTML(null, null, null, null, 'r4-2')}
                </div>
                <div class="connector right">
                    <div class="connector-line connector-2-to-1"></div>
                </div>
                <!-- CUARTOS -->
                <div class="round">
                    <div class="round-title">4tos de Final</div>
                    ${generateMatchupHTML(null, null, null, null, 'r8-3')}
                    ${generateMatchupHTML(null, null, null, null, 'r8-4')}
                </div>
                <!-- CONECTORES Y OCTAVOS -->
                <div class="connector right">
                    <div class="connector-line connector-2-to-1"></div>
                    <div class="connector-line connector-2-to-1"></div>
                </div>
                <div class="round">
                    <div class="round-title">8vos de Final</div>
                    ${generateMatchupHTML(sortedB[0], sortedA[7], '1°B', '8°A', 'r16-5')}
                    ${generateMatchupHTML(sortedB[3], sortedA[4], '4°B', '5°A', 'r16-6')}
                    ${generateMatchupHTML(sortedB[1], sortedA[6], '2°B', '7°A', 'r16-7')}
                    ${generateMatchupHTML(sortedB[2], sortedA[5], '3°B', '6°A', 'r16-8')}
                </div>
            </div>
        </div>
    `;
    playoffsContainer.innerHTML = bracketHTML;
}

function generateMatchupHTML(team1, team2, pos1, pos2, matchId) {
    // Si no hay team1, es un placeholder para una ronda futura
    if (!team1) {
        return `
        <div class="matchup">
            <div class="match-item" id="${matchId}" data-match-id="${matchId}"> 
                <div class="team" data-team-name="A definir">
                    <img src="" class="team-logo">
                    <span>A definir</span>
                    <span class="team-pos"></span>
                </div>
                <hr class="my-1 border-slate-200">
                <div class="team" data-team-name="A definir">
                    <img src="" class="team-logo">
                    <span>A definir</span>
                    <span class="team-pos"></span>
                </div>
            </div>
        </div>
        `;
    }

    // Es un partido de octavos con equipos definidos
    const t1 = team1 || { name: 'A definir' };
    const t2 = team2 || { name: 'A definir' };
    return `
        <div class="matchup">
            <div class="match-item" data-match-id="${matchId}">
                <div class="team" onclick="handleTeamClick(this)" data-team-name="${t1.name}" data-team-logo="${teamLogos[t1.name] || ''}">
                    <img src="${teamLogos[t1.name] || ''}" class="team-logo">
                    <span>${t1.name}</span>
                    <span class="team-pos">${pos1 || ''}</span>
                </div>
                <hr class="my-1 border-slate-200">
                <div class="team" onclick="handleTeamClick(this)" data-team-name="${t2.name}" data-team-logo="${teamLogos[t2.name] || ''}">
                    <img src="${teamLogos[t2.name] || ''}" class="team-logo">
                    <span>${t2.name}</span>
                    <span class="team-pos">${pos2 || ''}</span>
                </div>
            </div>
        </div>
    `;
}


function handleScoreChange(matchId, side, value) {
    if (!matchResults[matchId]) {
        const originalMatch = initialRemainingMatches.find(m => m.id === matchId);
        matchResults[matchId] = { 
            local: originalMatch.local, 
            visitante: originalMatch.visitante, 
            localScore: null, 
            visitorScore: null 
        };
    }
    const score = value === '' ? null : parseInt(value);
    if (side === 'local') { 
        matchResults[matchId].localScore = score; 
    } else { 
        matchResults[matchId].visitorScore = score; 
    }
    renderTables();
}

function renderMatches() {
    const container = document.getElementById('matches-container');
    container.innerHTML = '';
    const matchesByFecha = initialRemainingMatches.reduce((acc, match, index) => {
        match.id = index;
        const key = `Fecha ${match.fecha}`;
        if (!acc[key]) acc[key] = [];
        acc[key].push(match);
        return acc;
    }, {});
    container.innerHTML += Object.entries(matchesByFecha).map(([fecha, matches]) => `
        <div class="mb-5">
            <h4 class="font-semibold text-md text-slate-600 border-b pb-2 mb-3">${fecha} ${matches[0].status ? `(${matches[0].status})` : ''}</h4>
            <div class="space-y-3">
            ${matches.map(match => `
                <div class="grid grid-cols-[1fr,auto,1fr] gap-2 items-center text-sm">
                    <span class="text-right flex items-center justify-end gap-2">${match.local} <img src="${teamLogos[match.local] || ''}" class="team-logo" alt="logo"></span>
                    <div class="flex items-center gap-1">
                        <input type="number" min="0" class="input-score" id="local-${match.id}" oninput="handleScoreChange(${match.id}, 'local', this.value)">
                        <span>-</span>
                        <input type="number" min="0" class="input-score" id="visitor-${match.id}" oninput="handleScoreChange(${match.id}, 'visitor', this.value)">
                    </div>
                    <span class="text-left flex items-center gap-2"><img src="${teamLogos[match.visitante] || ''}" class="team-logo" alt="logo"> ${match.visitante}</span>
                </div>`).join('')}
            </div>
        </div>`).join('');
}

function toggleAnualTable() {
    const anualContainer = document.getElementById('anual-container');
    anualContainer.classList.toggle('hidden');
}

function resetResults() {
    // Clear the results object
    matchResults = {};

    // Clear the input fields in the UI
    const inputs = document.querySelectorAll('.input-score');
    inputs.forEach(input => {
        input.value = '';
    });

    // Re-render the tables to show the initial state
    renderTables();
}

/* Escalado responsivo sin modificar nada interno */
function fitBracket(){
  const vp = document.querySelector('.bracket-viewport');
  if (!vp) return;
  const el = vp.querySelector('.bracket');
  if (!el) return;

  // Resetear la escala para medir correctamente
  el.style.transform = 'scale(1)';
  
  const scale = Math.min(1, vp.clientWidth / el.scrollWidth);
  el.style.transform = `scale(${scale})`;
}

// --- NUEVA FUNCIONALIDAD DE CLIC EN BRACKET ---

// Mapa de lógica del bracket: qué partido alimenta qué slot
const bracketLogic = {
    'r16-1': { target: 'r8-1', slot: 1 }, // slot 1 = top
    'r16-2': { target: 'r8-1', slot: 2 }, // slot 2 = bottom
    'r16-3': { target: 'r8-2', slot: 1 },
    'r16-4': { target: 'r8-2', slot: 2 },
    'r16-5': { target: 'r8-3', slot: 1 },
    'r16-6': { target: 'r8-3', slot: 2 },
    'r16-7': { target: 'r8-4', slot: 1 },
    'r16-8': { target: 'r8-4', slot: 2 },
    
    'r8-1': { target: 'r4-1', slot: 1 },
    'r8-2': { target: 'r4-1', slot: 2 },
    'r8-3': { target: 'r4-2', slot: 1 },
    'r8-4': { target: 'r4-2', slot: 2 },

    'r4-1': { target: 'r2-1', slot: 1 },
    'r4-2': { target: 'r2-1', slot: 2 }
};

// Esta función se llama cada vez que se renderizan las tablas
function addBracketListeners() {
    const matchups = document.querySelectorAll('.match-item[data-match-id]');
    
    matchups.forEach(match => {
        const matchId = match.dataset.matchId;
        const logic = bracketLogic[matchId];

        const teams = match.querySelectorAll('.team');
        teams.forEach((team) => {
            // Asegurarse de no agregar listeners duplicados
            // if (!team.hasClickListener) { // Se quita para re-asignar en cada render
                team.style.cursor = 'pointer'; // Hacer que parezca clickeable
                team.hasClickListener = true; // Marcar que ya tiene listener
                
                team.onclick = () => {
                    const teamName = team.dataset.teamName;
                    const teamHTML = team.innerHTML; // <--- CAMBIO: Obtener HTML
                    
                    if (!teamName || teamName === 'A definir') return;
                    
                    // Resaltar selección
                    teams.forEach(t => {
                        t.style.opacity = '0.5'; // Apagar ambos
                        t.style.fontWeight = 'normal';
                    });
                    team.style.opacity = '1'; // Encender el seleccionado
                    team.style.fontWeight = 'bold';

                    // Avanzar el equipo al siguiente slot (si tiene lógica)
                    if(logic) {
                        advanceTeam(logic.target, logic.slot, teamHTML, teamName, matchId); // <--- CAMBIO: Pasar HTML
                    }
                };
            // }
        });
    });
}

// Función que avanza el equipo al siguiente slot
function advanceTeam(targetMatchId, targetSlot, teamHTML, teamName, sourceMatchId) { // <--- CAMBIO: Recibir HTML
    const targetMatchElement = document.getElementById(targetMatchId);
    if (!targetMatchElement) return;

    // Encontrar el slot (div.team) específico (1 = top, 2 = bottom)
    const targetSlotElement = targetMatchElement.querySelectorAll('.team')[targetSlot - 1];
    
    if (targetSlotElement) {
        // Si el slot ya tiene un equipo de un partido DIFERENTE, no lo borres
        // (esto previene que r16-2 borre lo que puso r16-1)
        const currentSource = targetSlotElement.dataset.sourceMatch;
        if (currentSource && currentSource !== sourceMatchId) {
             // Ya hay un ganador de otro partido, no hacer nada
        } else {
            // Actualizar el slot con el nuevo equipo
            targetSlotElement.innerHTML = teamHTML; // <--- CAMBIO: Insertar HTML
            targetSlotElement.dataset.teamName = teamName;
        }

        // Limpiar el slot opuesto si el ganador viene del mismo partido
        const otherSlot = targetSlotElement.parentElement.querySelectorAll('.team')[targetSlot === 1 ? 1 : 0];
        if (otherSlot && otherSlot.dataset.sourceMatch === sourceMatchId) {
             otherSlot.innerHTML = '<img src="" class="team-logo"><span>A definir</span><span class="team-pos"></span>'; // <--- CAMBIO: Resetear HTML
             otherSlot.dataset.teamName = 'A definir';
        }
        
        targetSlotElement.dataset.sourceMatch = sourceMatchId;

        // Limpiar las selecciones de la *siguiente* ronda si este partido cambia
        clearNextRounds(targetMatchId);
    }
    
    // Volver a agregar listeners para la siguiente ronda (ej. Cuartos)
    addBracketListeners();
}

// Función para limpiar rondas futuras si se cambia un ganador
function clearNextRounds(changedMatchId) {
    let currentTarget = changedMatchId;
    while (bracketLogic[currentTarget]) {
        const nextTargetId = bracketLogic[currentTarget].target;
        const nextMatchElement = document.getElementById(nextTargetId);
        
        if (nextMatchElement) {
            // Resetear los slots de ese partido
            nextMatchElement.querySelectorAll('.team').forEach(teamSlot => {
                teamSlot.innerHTML = '<img src="" class="team-logo"><span>A definir</span><span class="team-pos"></span>'; // <--- CAMBIO: Resetear HTML
                teamSlot.dataset.teamName = 'A definir';
                teamSlot.dataset.sourceMatch = '';
                teamSlot.style.opacity = '1';
                teamSlot.style.fontWeight = 'normal';
            });
        }
        currentTarget = nextTargetId;
    }
}


</script>
</body>
</html>
